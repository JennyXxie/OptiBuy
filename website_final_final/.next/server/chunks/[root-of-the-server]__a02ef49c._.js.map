{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 133, "column": 0}, "map": {"version":3,"sources":["file:///Users/yunjinxie/Desktop/website/OptiBuy/src/lib/serpapi.ts"],"sourcesContent":["import axios from 'axios'\n\nconst SERPAPI_KEY = process.env.SERPAPI_KEY\n\nif (!SERPAPI_KEY) {\n  console.warn('‚ö†Ô∏è Missing SERPAPI_KEY in environment variables')\n}\n\nexport interface SerpApiProduct {\n  title: string\n  price: string\n  extracted_price: number\n  link: string\n  source: string\n  rating?: number\n  reviews?: number\n  thumbnail?: string\n  position: number\n}\n\nexport async function fetchSerpApiProducts(query: string, engine: string = 'google_shopping'): Promise<SerpApiProduct[]> {\n  if (!SERPAPI_KEY) {\n    console.warn('SERPAPI_KEY not available, returning empty results')\n    return []\n  }\n\n  try {\n    const url = `https://serpapi.com/search.json?q=${encodeURIComponent(query)}&engine=${engine}&api_key=${SERPAPI_KEY}`\n    \n    const response = await axios.get(url, {\n      timeout: 10000,\n    })\n\n    const results = response.data.shopping_results || response.data.organic_results || []\n    \n    return results.map((item: any) => ({\n      title: item.title || '',\n      price: item.price || '',\n      extracted_price: item.extracted_price || 0,\n      link: item.link || item.product_link || '',\n      source: item.source || 'Unknown',\n      rating: item.rating || undefined,\n      reviews: item.reviews || undefined,\n      thumbnail: item.thumbnail || '',\n      position: item.position || 0\n    }))\n  } catch (error) {\n    console.error('SerpAPI error:', error)\n    return []\n  }\n}\n\nexport async function fetchAmazonProducts(query: string): Promise<SerpApiProduct[]> {\n  return fetchSerpApiProducts(query, 'amazon')\n}\n\nexport async function fetchGoogleShoppingProducts(query: string): Promise<SerpApiProduct[]> {\n  return fetchSerpApiProducts(query, 'google_shopping')\n}\n"],"names":[],"mappings":";;;;;;;;AAAA;;AAEA,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW;AAE3C,IAAI,CAAC,aAAa;IAChB,QAAQ,IAAI,CAAC;AACf;AAcO,eAAe,qBAAqB,KAAa,EAAE,SAAiB,iBAAiB;IAC1F,IAAI,CAAC,aAAa;QAChB,QAAQ,IAAI,CAAC;QACb,OAAO,EAAE;IACX;IAEA,IAAI;QACF,MAAM,MAAM,CAAC,kCAAkC,EAAE,mBAAmB,OAAO,QAAQ,EAAE,OAAO,SAAS,EAAE,aAAa;QAEpH,MAAM,WAAW,MAAM,mLAAK,CAAC,GAAG,CAAC,KAAK;YACpC,SAAS;QACX;QAEA,MAAM,UAAU,SAAS,IAAI,CAAC,gBAAgB,IAAI,SAAS,IAAI,CAAC,eAAe,IAAI,EAAE;QAErF,OAAO,QAAQ,GAAG,CAAC,CAAC,OAAc,CAAC;gBACjC,OAAO,KAAK,KAAK,IAAI;gBACrB,OAAO,KAAK,KAAK,IAAI;gBACrB,iBAAiB,KAAK,eAAe,IAAI;gBACzC,MAAM,KAAK,IAAI,IAAI,KAAK,YAAY,IAAI;gBACxC,QAAQ,KAAK,MAAM,IAAI;gBACvB,QAAQ,KAAK,MAAM,IAAI;gBACvB,SAAS,KAAK,OAAO,IAAI;gBACzB,WAAW,KAAK,SAAS,IAAI;gBAC7B,UAAU,KAAK,QAAQ,IAAI;YAC7B,CAAC;IACH,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,kBAAkB;QAChC,OAAO,EAAE;IACX;AACF;AAEO,eAAe,oBAAoB,KAAa;IACrD,OAAO,qBAAqB,OAAO;AACrC;AAEO,eAAe,4BAA4B,KAAa;IAC7D,OAAO,qBAAqB,OAAO;AACrC","debugId":null}},
    {"offset": {"line": 190, "column": 0}, "map": {"version":3,"sources":["file:///Users/yunjinxie/Desktop/website/OptiBuy/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined\n}\n\nexport const prisma = globalForPrisma.prisma ?? new PrismaClient()\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SAAS,gBAAgB,MAAM,IAAI,IAAI,6IAAY;AAEhE,wCAA2C,gBAAgB,MAAM,GAAG","debugId":null}},
    {"offset": {"line": 203, "column": 0}, "map": {"version":3,"sources":["file:///Users/yunjinxie/Desktop/website/OptiBuy/src/app/api/products/search/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport { z } from 'zod'\nimport { fetchSerpApiProducts } from '@/lib/serpapi'\nimport { prisma } from '@/lib/prisma'\n\nconst searchSchema = z.object({\n  query: z.string().min(1),\n  limit: z.number().min(1).max(50).default(10),\n  category: z.string().optional(),\n})\n\nexport async function GET(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url)\n    const query = searchParams.get('query') || ''\n    const limit = parseInt(searchParams.get('limit') || '10')\n    const category = searchParams.get('category') || undefined\n\n    const validatedData = searchSchema.parse({\n      query,\n      limit,\n      category,\n    })\n\n    console.log(`üîç Searching for: ${validatedData.query}`)\n\n    // Fetch fresh data from SerpAPI (bypass cache)\n    const serpApiResults = await fetchSerpApiProducts(validatedData.query)\n    console.log(`üì¶ Got ${serpApiResults.length} results from SerpAPI`)\n\n    // Persist to DB and transform for frontend\n    const transformedProducts = [] as any[]\n    for (let index = 0; index < Math.min(limit, serpApiResults.length); index++) {\n      const product = serpApiResults[index]\n      const title = product.title\n      const platform = product.source\n      const price = product.extracted_price || 0\n      const imageUrl = product.thumbnail || '/placeholder-product.jpg'\n      const url = product.link || ''\n\n      // Upsert product by name + brand(platform)\n      const dbProduct = await prisma.product.upsert({\n        where: {\n          // Composite alternative via unique constraint is not present; emulate using name+brand\n          // Use a synthetic unique key in code: firstOrCreate\n          id: (await (async () => {\n            const existing = await prisma.product.findFirst({ where: { name: title, brand: platform } })\n            if (existing) return existing.id\n            const created = await prisma.product.create({\n              data: {\n                name: title,\n                description: `Product from ${platform}`,\n                imageUrl,\n                brand: platform,\n                category: 'General',\n              },\n            })\n            return created.id\n          })()),\n        },\n        update: {\n          imageUrl,\n        },\n        create: {\n          // The above branch should always handle creation; keep fallback\n          name: title,\n          description: `Product from ${platform}`,\n          imageUrl,\n          brand: platform,\n          category: 'General',\n        },\n      })\n\n      // Record current price point\n      await prisma.price.create({\n        data: {\n          productId: dbProduct.id,\n          platform,\n          price,\n          currency: 'USD',\n          url,\n          inStock: true,\n        },\n      })\n\n      transformedProducts.push({\n        id: `serpapi-${index}`,\n        dbId: dbProduct.id,\n        name: title,\n        description: `Product from ${platform}`,\n        imageUrl,\n        category: 'General',\n        brand: platform,\n        prices: {\n          [platform]: {\n            price,\n            platform,\n            url,\n            inStock: true,\n            createdAt: new Date(),\n          },\n        },\n        bestPrice: {\n          platform,\n          price,\n          savings: Math.floor(Math.random() * 20),\n        },\n        coupons: [],\n      })\n    }\n\n    console.log(`‚úÖ Returning ${transformedProducts.length} products`)\n\n    // Add cache control headers to prevent caching\n    const response = NextResponse.json({\n      success: true,\n      data: transformedProducts,\n      total: transformedProducts.length,\n    })\n\n    // Disable caching\n    response.headers.set('Cache-Control', 'no-store, no-cache, must-revalidate, proxy-revalidate')\n    response.headers.set('Pragma', 'no-cache')\n    response.headers.set('Expires', '0')\n\n    return response\n  } catch (error) {\n    console.error('Product search error:', error)\n    \n    if (error instanceof z.ZodError) {\n      return NextResponse.json(\n        { success: false, error: 'Invalid search parameters', details: error.errors },\n        { status: 400 }\n      )\n    }\n\n    return NextResponse.json(\n      { success: false, error: 'Internal server error' },\n      { status: 500 }\n    )\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json()\n    \n    return NextResponse.json({\n      success: true,\n      message: 'Search query logged',\n    })\n  } catch (error) {\n    console.error('Search logging error:', error)\n    return NextResponse.json(\n      { success: false, error: 'Failed to log search' },\n      { status: 500 }\n    )\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}