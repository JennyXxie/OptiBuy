module.exports = [
"[project]/Desktop/website/OptiBuy/.next-internal/server/app/api/products/search/route/actions.js [app-rsc] (server actions loader, ecmascript)", ((__turbopack_context__, module, exports) => {

}),
"[externals]/next/dist/compiled/next-server/app-route-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-route-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/compiled/@opentelemetry/api [external] (next/dist/compiled/@opentelemetry/api, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/@opentelemetry/api", () => require("next/dist/compiled/@opentelemetry/api"));

module.exports = mod;
}),
"[externals]/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-page-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-unit-async-storage.external.js", () => require("next/dist/server/app-render/work-unit-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-async-storage.external.js", () => require("next/dist/server/app-render/work-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/shared/lib/no-fallback-error.external.js [external] (next/dist/shared/lib/no-fallback-error.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/shared/lib/no-fallback-error.external.js", () => require("next/dist/shared/lib/no-fallback-error.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/after-task-async-storage.external.js [external] (next/dist/server/app-render/after-task-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/after-task-async-storage.external.js", () => require("next/dist/server/app-render/after-task-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/action-async-storage.external.js [external] (next/dist/server/app-render/action-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/action-async-storage.external.js", () => require("next/dist/server/app-render/action-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/util [external] (util, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("util", () => require("util"));

module.exports = mod;
}),
"[externals]/stream [external] (stream, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("stream", () => require("stream"));

module.exports = mod;
}),
"[externals]/path [external] (path, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("path", () => require("path"));

module.exports = mod;
}),
"[externals]/http [external] (http, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("http", () => require("http"));

module.exports = mod;
}),
"[externals]/https [external] (https, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("https", () => require("https"));

module.exports = mod;
}),
"[externals]/url [external] (url, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("url", () => require("url"));

module.exports = mod;
}),
"[externals]/fs [external] (fs, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("fs", () => require("fs"));

module.exports = mod;
}),
"[externals]/crypto [external] (crypto, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("crypto", () => require("crypto"));

module.exports = mod;
}),
"[externals]/assert [external] (assert, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("assert", () => require("assert"));

module.exports = mod;
}),
"[externals]/tty [external] (tty, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("tty", () => require("tty"));

module.exports = mod;
}),
"[externals]/os [external] (os, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("os", () => require("os"));

module.exports = mod;
}),
"[externals]/zlib [external] (zlib, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("zlib", () => require("zlib"));

module.exports = mod;
}),
"[externals]/events [external] (events, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("events", () => require("events"));

module.exports = mod;
}),
"[externals]/node:stream [external] (node:stream, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:stream", () => require("node:stream"));

module.exports = mod;
}),
"[externals]/buffer [external] (buffer, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("buffer", () => require("buffer"));

module.exports = mod;
}),
"[externals]/string_decoder [external] (string_decoder, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("string_decoder", () => require("string_decoder"));

module.exports = mod;
}),
"[externals]/node:assert [external] (node:assert, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:assert", () => require("node:assert"));

module.exports = mod;
}),
"[externals]/node:net [external] (node:net, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:net", () => require("node:net"));

module.exports = mod;
}),
"[externals]/node:http [external] (node:http, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:http", () => require("node:http"));

module.exports = mod;
}),
"[externals]/node:querystring [external] (node:querystring, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:querystring", () => require("node:querystring"));

module.exports = mod;
}),
"[externals]/node:events [external] (node:events, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:events", () => require("node:events"));

module.exports = mod;
}),
"[externals]/node:diagnostics_channel [external] (node:diagnostics_channel, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:diagnostics_channel", () => require("node:diagnostics_channel"));

module.exports = mod;
}),
"[externals]/node:util [external] (node:util, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:util", () => require("node:util"));

module.exports = mod;
}),
"[externals]/node:tls [external] (node:tls, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:tls", () => require("node:tls"));

module.exports = mod;
}),
"[externals]/node:buffer [external] (node:buffer, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:buffer", () => require("node:buffer"));

module.exports = mod;
}),
"[externals]/node:zlib [external] (node:zlib, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:zlib", () => require("node:zlib"));

module.exports = mod;
}),
"[externals]/node:perf_hooks [external] (node:perf_hooks, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:perf_hooks", () => require("node:perf_hooks"));

module.exports = mod;
}),
"[externals]/node:util/types [external] (node:util/types, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:util/types", () => require("node:util/types"));

module.exports = mod;
}),
"[externals]/node:worker_threads [external] (node:worker_threads, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:worker_threads", () => require("node:worker_threads"));

module.exports = mod;
}),
"[externals]/node:crypto [external] (node:crypto, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:crypto", () => require("node:crypto"));

module.exports = mod;
}),
"[externals]/node:http2 [external] (node:http2, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:http2", () => require("node:http2"));

module.exports = mod;
}),
"[externals]/node:async_hooks [external] (node:async_hooks, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:async_hooks", () => require("node:async_hooks"));

module.exports = mod;
}),
"[externals]/node:console [external] (node:console, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:console", () => require("node:console"));

module.exports = mod;
}),
"[externals]/node:fs/promises [external] (node:fs/promises, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:fs/promises", () => require("node:fs/promises"));

module.exports = mod;
}),
"[externals]/node:path [external] (node:path, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:path", () => require("node:path"));

module.exports = mod;
}),
"[externals]/node:timers [external] (node:timers, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:timers", () => require("node:timers"));

module.exports = mod;
}),
"[externals]/node:dns [external] (node:dns, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:dns", () => require("node:dns"));

module.exports = mod;
}),
"[project]/Desktop/website/OptiBuy/src/lib/scrapers.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "WebScraper",
    ()=>WebScraper
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$Desktop$2f$website$2f$OptiBuy$2f$node_modules$2f$axios$2f$lib$2f$axios$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/Desktop/website/OptiBuy/node_modules/axios/lib/axios.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$Desktop$2f$website$2f$OptiBuy$2f$node_modules$2f$cheerio$2f$dist$2f$esm$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/Desktop/website/OptiBuy/node_modules/cheerio/dist/esm/index.js [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$Desktop$2f$website$2f$OptiBuy$2f$node_modules$2f$cheerio$2f$dist$2f$esm$2f$load$2d$parse$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/Desktop/website/OptiBuy/node_modules/cheerio/dist/esm/load-parse.js [app-route] (ecmascript)");
;
;
class WebScraper {
    static USER_AGENT = 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36';
    static async fetchPage(url) {
        try {
            const response = await __TURBOPACK__imported__module__$5b$project$5d2f$Desktop$2f$website$2f$OptiBuy$2f$node_modules$2f$axios$2f$lib$2f$axios$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].get(url, {
                headers: {
                    'User-Agent': this.USER_AGENT,
                    'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8',
                    'Accept-Language': 'en-US,en;q=0.5',
                    'Accept-Encoding': 'gzip, deflate',
                    'Connection': 'keep-alive'
                },
                timeout: 10000
            });
            return response.data;
        } catch (error) {
            console.error(`Error fetching ${url}:`, error);
            throw error;
        }
    }
    static async scrapeTemu(query) {
        try {
            const searchUrl = `https://www.temu.com/search_result.html?search_key=${encodeURIComponent(query)}`;
            const html = await this.fetchPage(searchUrl);
            const $ = __TURBOPACK__imported__module__$5b$project$5d2f$Desktop$2f$website$2f$OptiBuy$2f$node_modules$2f$cheerio$2f$dist$2f$esm$2f$load$2d$parse$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["load"](html);
            const products = [];
            $('[data-testid="product-item"], .product-item, .search-result-item').each((index, element)=>{
                if (products.length >= 10) return false // Limit to 10 products
                ;
                const name = $(element).find('[data-testid="product-title"], .product-title, .title').first().text().trim();
                const priceText = $(element).find('[data-testid="price"], .price, .current-price').first().text().trim();
                const image = $(element).find('img').first().attr('src') || '';
                const url = $(element).find('a').first().attr('href') || '';
                const rating = parseFloat($(element).find('[data-testid="rating"], .rating').first().text()) || undefined;
                const reviews = parseInt($(element).find('[data-testid="reviews"], .reviews').first().text().replace(/[^\d]/g, '')) || undefined;
                if (name && priceText) {
                    const price = parseFloat(priceText.replace(/[^\d.]/g, ''));
                    if (!isNaN(price)) {
                        products.push({
                            name,
                            price,
                            image: image.startsWith('http') ? image : `https:${image}`,
                            url: url.startsWith('http') ? url : `https://www.temu.com${url}`,
                            rating,
                            reviews,
                            platform: 'temu'
                        });
                    }
                }
            });
            return products;
        } catch (error) {
            console.error('Temu scraping error:', error);
            return [];
        }
    }
    static async scrapeEbay(query) {
        try {
            const searchUrl = `https://www.ebay.com/sch/i.html?_nkw=${encodeURIComponent(query)}&_sop=15`;
            const html = await this.fetchPage(searchUrl);
            const $ = __TURBOPACK__imported__module__$5b$project$5d2f$Desktop$2f$website$2f$OptiBuy$2f$node_modules$2f$cheerio$2f$dist$2f$esm$2f$load$2d$parse$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["load"](html);
            const products = [];
            $('.s-item').each((index, element)=>{
                if (products.length >= 10) return false // Limit to 10 products
                ;
                const name = $(element).find('.s-item__title').text().trim();
                const priceText = $(element).find('.s-item__price').text().trim();
                const image = $(element).find('.s-item__image img').attr('src') || '';
                const url = $(element).find('.s-item__link').attr('href') || '';
                const rating = parseFloat($(element).find('.s-item__reviews .clipped').text()) || undefined;
                const reviews = parseInt($(element).find('.s-item__reviews .s-item__review-count').text().replace(/[^\d]/g, '')) || undefined;
                if (name && priceText && !name.includes('Shop on eBay')) {
                    const price = parseFloat(priceText.replace(/[^\d.]/g, ''));
                    if (!isNaN(price)) {
                        products.push({
                            name,
                            price,
                            image,
                            url,
                            rating,
                            reviews,
                            platform: 'ebay'
                        });
                    }
                }
            });
            return products;
        } catch (error) {
            console.error('eBay scraping error:', error);
            return [];
        }
    }
    static async scrapeWalmart(query) {
        try {
            const searchUrl = `https://www.walmart.com/search?q=${encodeURIComponent(query)}`;
            const html = await this.fetchPage(searchUrl);
            const $ = __TURBOPACK__imported__module__$5b$project$5d2f$Desktop$2f$website$2f$OptiBuy$2f$node_modules$2f$cheerio$2f$dist$2f$esm$2f$load$2d$parse$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["load"](html);
            const products = [];
            $('[data-testid="item-stack"], .search-result-gridview-item').each((index, element)=>{
                if (products.length >= 10) return false // Limit to 10 products
                ;
                const name = $(element).find('[data-testid="item-stack-title"], .search-result-product-title').text().trim();
                const priceText = $(element).find('[data-testid="item-stack-price"], .price-main').text().trim();
                const image = $(element).find('img').first().attr('src') || '';
                const url = $(element).find('a').first().attr('href') || '';
                const rating = parseFloat($(element).find('[data-testid="item-stack-rating"], .stars').attr('aria-label')?.replace(/[^\d.]/g, '')) || undefined;
                const reviews = parseInt($(element).find('[data-testid="item-stack-reviews"], .reviews-count').text().replace(/[^\d]/g, '')) || undefined;
                if (name && priceText) {
                    const price = parseFloat(priceText.replace(/[^\d.]/g, ''));
                    if (!isNaN(price)) {
                        products.push({
                            name,
                            price,
                            image,
                            url: url.startsWith('http') ? url : `https://www.walmart.com${url}`,
                            rating,
                            reviews,
                            platform: 'walmart'
                        });
                    }
                }
            });
            return products;
        } catch (error) {
            console.error('Walmart scraping error:', error);
            return [];
        }
    }
    static async scrapeAll(query) {
        try {
            const [temuResults, ebayResults, walmartResults] = await Promise.allSettled([
                this.scrapeTemu(query),
                this.scrapeEbay(query),
                this.scrapeWalmart(query)
            ]);
            const allProducts = [];
            if (temuResults.status === 'fulfilled') {
                allProducts.push(...temuResults.value);
            }
            if (ebayResults.status === 'fulfilled') {
                allProducts.push(...ebayResults.value);
            }
            if (walmartResults.status === 'fulfilled') {
                allProducts.push(...walmartResults.value);
            }
            return allProducts;
        } catch (error) {
            console.error('Error scraping all platforms:', error);
            return [];
        }
    }
}
}),
"[project]/Desktop/website/OptiBuy/src/lib/serpapi.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "fetchAmazonProducts",
    ()=>fetchAmazonProducts,
    "fetchGoogleShoppingProducts",
    ()=>fetchGoogleShoppingProducts,
    "fetchSerpApiProducts",
    ()=>fetchSerpApiProducts
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$Desktop$2f$website$2f$OptiBuy$2f$node_modules$2f$axios$2f$lib$2f$axios$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/Desktop/website/OptiBuy/node_modules/axios/lib/axios.js [app-route] (ecmascript)");
;
const SERPAPI_KEY = process.env.SERPAPI_KEY;
if (!SERPAPI_KEY) {
    console.warn('⚠️ Missing SERPAPI_KEY in environment variables');
}
async function fetchSerpApiProducts(query, engine = 'google_shopping') {
    if (!SERPAPI_KEY) {
        console.warn('SERPAPI_KEY not available, returning empty results');
        return [];
    }
    try {
        const url = `https://serpapi.com/search.json?q=${encodeURIComponent(query)}&engine=${engine}&api_key=${SERPAPI_KEY}`;
        const response = await __TURBOPACK__imported__module__$5b$project$5d2f$Desktop$2f$website$2f$OptiBuy$2f$node_modules$2f$axios$2f$lib$2f$axios$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].get(url, {
            timeout: 10000
        });
        const results = response.data.shopping_results || response.data.organic_results || [];
        return results.map((item)=>({
                title: item.title || '',
                price: item.price || '',
                extracted_price: item.extracted_price || 0,
                link: item.link || item.product_link || '',
                source: item.source || 'Unknown',
                rating: item.rating || undefined,
                reviews: item.reviews || undefined,
                thumbnail: item.thumbnail || '',
                position: item.position || 0
            }));
    } catch (error) {
        console.error('SerpAPI error:', error);
        return [];
    }
}
async function fetchAmazonProducts(query) {
    return fetchSerpApiProducts(query, 'amazon');
}
async function fetchGoogleShoppingProducts(query) {
    return fetchSerpApiProducts(query, 'google_shopping');
}
}),
"[externals]/@prisma/client [external] (@prisma/client, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("@prisma/client", () => require("@prisma/client"));

module.exports = mod;
}),
"[project]/Desktop/website/OptiBuy/src/lib/prisma.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "prisma",
    ()=>prisma
]);
var __TURBOPACK__imported__module__$5b$externals$5d2f40$prisma$2f$client__$5b$external$5d$__$2840$prisma$2f$client$2c$__cjs$29$__ = __turbopack_context__.i("[externals]/@prisma/client [external] (@prisma/client, cjs)");
;
const globalForPrisma = globalThis;
const prisma = globalForPrisma.prisma ?? new __TURBOPACK__imported__module__$5b$externals$5d2f40$prisma$2f$client__$5b$external$5d$__$2840$prisma$2f$client$2c$__cjs$29$__["PrismaClient"]();
if ("TURBOPACK compile-time truthy", 1) globalForPrisma.prisma = prisma;
}),
"[project]/Desktop/website/OptiBuy/src/lib/product-service.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "ProductService",
    ()=>ProductService
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$Desktop$2f$website$2f$OptiBuy$2f$src$2f$lib$2f$scrapers$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/Desktop/website/OptiBuy/src/lib/scrapers.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$Desktop$2f$website$2f$OptiBuy$2f$src$2f$lib$2f$serpapi$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/Desktop/website/OptiBuy/src/lib/serpapi.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$Desktop$2f$website$2f$OptiBuy$2f$src$2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/Desktop/website/OptiBuy/src/lib/prisma.ts [app-route] (ecmascript)");
;
;
;
class ProductService {
    static async searchProducts(query, useCache = true) {
        try {
            // Check cache first if enabled
            if (useCache) {
                const cachedProducts = await this.getCachedProducts(query);
                if (cachedProducts.length > 0) {
                    console.log(`Cache hit for query: ${query}`);
                    return cachedProducts;
                }
            }
            // Fetch from multiple sources
            const [serpApiResults, scraperResults] = await Promise.allSettled([
                this.fetchFromSerpApi(query),
                this.fetchFromScrapers(query)
            ]);
            const allProducts = [];
            // Process SerpAPI results
            if (serpApiResults.status === 'fulfilled') {
                allProducts.push(...serpApiResults.value);
            }
            // Process scraper results
            if (scraperResults.status === 'fulfilled') {
                allProducts.push(...scraperResults.value);
            }
            // Remove duplicates and sort by price
            const uniqueProducts = this.deduplicateProducts(allProducts);
            const sortedProducts = uniqueProducts.sort((a, b)=>a.price - b.price);
            // Cache results if enabled
            if (useCache && sortedProducts.length > 0) {
                await this.cacheProducts(query, sortedProducts);
            }
            // Save to database
            await this.saveProductsToDatabase(sortedProducts);
            return sortedProducts.slice(0, 20) // Limit to 20 products
            ;
        } catch (error) {
            console.error('Product search error:', error);
            return [];
        }
    }
    static async fetchFromSerpApi(query) {
        try {
            const serpResults = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$Desktop$2f$website$2f$OptiBuy$2f$src$2f$lib$2f$serpapi$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["fetchSerpApiProducts"])(query);
            return serpResults.map((product)=>({
                    name: product.title,
                    price: product.extracted_price,
                    image: product.thumbnail || '',
                    url: product.link,
                    platform: product.source.toLowerCase(),
                    rating: product.rating,
                    reviews: product.reviews,
                    currency: 'USD',
                    inStock: true,
                    source: 'serpapi'
                }));
        } catch (error) {
            console.error('SerpAPI fetch error:', error);
            return [];
        }
    }
    static async fetchFromScrapers(query) {
        try {
            const scraperResults = await __TURBOPACK__imported__module__$5b$project$5d2f$Desktop$2f$website$2f$OptiBuy$2f$src$2f$lib$2f$scrapers$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["WebScraper"].scrapeAll(query);
            return scraperResults.map((product)=>({
                    name: product.name,
                    price: product.price,
                    image: product.image,
                    url: product.url,
                    platform: product.platform,
                    rating: product.rating,
                    reviews: product.reviews,
                    currency: 'USD',
                    inStock: true,
                    source: 'scraper'
                }));
        } catch (error) {
            console.error('Scraper fetch error:', error);
            return [];
        }
    }
    static deduplicateProducts(products) {
        const seen = new Set();
        return products.filter((product)=>{
            const key = `${product.name.toLowerCase()}-${product.platform}`;
            if (seen.has(key)) {
                return false;
            }
            seen.add(key);
            return true;
        });
    }
    static async getCachedProducts(query) {
        try {
            const cached = await __TURBOPACK__imported__module__$5b$project$5d2f$Desktop$2f$website$2f$OptiBuy$2f$src$2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["prisma"].product.findMany({
                where: {
                    OR: [
                        {
                            name: {
                                contains: query
                            }
                        },
                        {
                            description: {
                                contains: query
                            }
                        }
                    ]
                },
                include: {
                    prices: {
                        orderBy: {
                            createdAt: 'desc'
                        },
                        take: 1
                    }
                },
                take: 20
            });
            return cached.map((product)=>({
                    id: product.id,
                    name: product.name,
                    price: product.prices[0]?.price || 0,
                    image: product.imageUrl || '',
                    url: product.prices[0]?.url || '',
                    platform: product.prices[0]?.platform || 'unknown',
                    currency: 'USD',
                    inStock: product.prices[0]?.inStock || true,
                    source: 'database'
                }));
        } catch (error) {
            console.error('Cache retrieval error:', error);
            return [];
        }
    }
    static async cacheProducts(query, products) {
        try {
            // This would typically use a Redis cache or similar
            // For now, we'll just save to database
            console.log(`Caching ${products.length} products for query: ${query}`);
        } catch (error) {
            console.error('Cache storage error:', error);
        }
    }
    static async saveProductsToDatabase(products) {
        try {
            for (const product of products){
                // Find or create product
                const existingProduct = await __TURBOPACK__imported__module__$5b$project$5d2f$Desktop$2f$website$2f$OptiBuy$2f$src$2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["prisma"].product.findFirst({
                    where: {
                        name: product.name,
                        brand: product.platform
                    }
                });
                let productId;
                if (existingProduct) {
                    productId = existingProduct.id;
                } else {
                    const newProduct = await __TURBOPACK__imported__module__$5b$project$5d2f$Desktop$2f$website$2f$OptiBuy$2f$src$2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["prisma"].product.create({
                        data: {
                            name: product.name,
                            description: `Product from ${product.platform}`,
                            imageUrl: product.image,
                            brand: product.platform,
                            category: 'General'
                        }
                    });
                    productId = newProduct.id;
                }
                // Save price data
                await __TURBOPACK__imported__module__$5b$project$5d2f$Desktop$2f$website$2f$OptiBuy$2f$src$2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["prisma"].price.create({
                    data: {
                        productId,
                        platform: product.platform,
                        price: product.price,
                        currency: product.currency,
                        url: product.url,
                        inStock: product.inStock
                    }
                });
            }
        } catch (error) {
            console.error('Database save error:', error);
        }
    }
    static async getProductPriceHistory(productId) {
        try {
            const prices = await __TURBOPACK__imported__module__$5b$project$5d2f$Desktop$2f$website$2f$OptiBuy$2f$src$2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["prisma"].price.findMany({
                where: {
                    productId
                },
                orderBy: {
                    createdAt: 'asc'
                }
            });
            return prices.map((price)=>({
                    date: price.createdAt,
                    price: price.price,
                    platform: price.platform,
                    inStock: price.inStock
                }));
        } catch (error) {
            console.error('Price history error:', error);
            return [];
        }
    }
}
}),
"[project]/Desktop/website/OptiBuy/src/app/api/products/search/route.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "GET",
    ()=>GET,
    "POST",
    ()=>POST
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$Desktop$2f$website$2f$OptiBuy$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/Desktop/website/OptiBuy/node_modules/next/server.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$Desktop$2f$website$2f$OptiBuy$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__ = __turbopack_context__.i("[project]/Desktop/website/OptiBuy/node_modules/zod/v4/classic/external.js [app-route] (ecmascript) <export * as z>");
var __TURBOPACK__imported__module__$5b$project$5d2f$Desktop$2f$website$2f$OptiBuy$2f$src$2f$lib$2f$product$2d$service$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/Desktop/website/OptiBuy/src/lib/product-service.ts [app-route] (ecmascript)");
;
;
;
const searchSchema = __TURBOPACK__imported__module__$5b$project$5d2f$Desktop$2f$website$2f$OptiBuy$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].object({
    query: __TURBOPACK__imported__module__$5b$project$5d2f$Desktop$2f$website$2f$OptiBuy$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].string().min(1),
    limit: __TURBOPACK__imported__module__$5b$project$5d2f$Desktop$2f$website$2f$OptiBuy$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].number().min(1).max(50).default(10),
    category: __TURBOPACK__imported__module__$5b$project$5d2f$Desktop$2f$website$2f$OptiBuy$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].string().optional()
});
async function GET(request) {
    try {
        const { searchParams } = new URL(request.url);
        const query = searchParams.get('query') || '';
        const limit = parseInt(searchParams.get('limit') || '10');
        const category = searchParams.get('category') || undefined;
        const validatedData = searchSchema.parse({
            query,
            limit,
            category
        });
        // Use ProductService to search across all platforms
        const products = await __TURBOPACK__imported__module__$5b$project$5d2f$Desktop$2f$website$2f$OptiBuy$2f$src$2f$lib$2f$product$2d$service$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ProductService"].searchProducts(validatedData.query);
        // Transform data for frontend
        const transformedProducts = products.map((product)=>({
                id: product.id,
                name: product.name,
                description: `Product from ${product.platform}`,
                imageUrl: product.image,
                category: 'General',
                brand: product.platform,
                prices: {
                    [product.platform]: {
                        price: product.price,
                        platform: product.platform,
                        url: product.url,
                        inStock: product.inStock,
                        createdAt: new Date()
                    }
                },
                bestPrice: {
                    platform: product.platform,
                    price: product.price,
                    savings: 0
                },
                coupons: []
            }));
        return __TURBOPACK__imported__module__$5b$project$5d2f$Desktop$2f$website$2f$OptiBuy$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            success: true,
            data: transformedProducts,
            total: products.length
        });
    } catch (error) {
        console.error('Product search error:', error);
        if (error instanceof __TURBOPACK__imported__module__$5b$project$5d2f$Desktop$2f$website$2f$OptiBuy$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].ZodError) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$Desktop$2f$website$2f$OptiBuy$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                success: false,
                error: 'Invalid search parameters',
                details: error.errors
            }, {
                status: 400
            });
        }
        return __TURBOPACK__imported__module__$5b$project$5d2f$Desktop$2f$website$2f$OptiBuy$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            success: false,
            error: 'Internal server error'
        }, {
            status: 500
        });
    }
}
async function POST(request) {
    try {
        const body = await request.json();
        // For now, return mock data for demonstration
        // In production, this would save search queries or track user behavior
        return __TURBOPACK__imported__module__$5b$project$5d2f$Desktop$2f$website$2f$OptiBuy$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            success: true,
            message: 'Search query logged'
        });
    } catch (error) {
        console.error('Search logging error:', error);
        return __TURBOPACK__imported__module__$5b$project$5d2f$Desktop$2f$website$2f$OptiBuy$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            success: false,
            error: 'Failed to log search'
        }, {
            status: 500
        });
    }
}
}),
];

//# sourceMappingURL=%5Broot-of-the-server%5D__c622c0a9._.js.map